<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>
<body>
  <!--Aba medicamento-->

<section id="medicamentoDados" class="col m12 s12">
  <div class="col m12">
    <br>
    <table class="responsive-table">
      <thead>
        <tr class="rows">
          <th class="grey lighten-1 font-normal" >Medicamento</th>
          <th class="grey lighten-1 font-normal" >Via de administração</th>
          <th class="grey lighten-1 font-normal">Posologia</th>
          <th class="grey lighten-1 font-normal">Ação</th>
        </tr>
      </thead>
      <tbody id="tabela-medicamento-body">
        <tr class="row">
          <td>
            <select name="medicamentoNome[]">
              <option value="" disabled selected>Selecione</option>
              <option value="" disabled selected>parecetamol</option>
              <option value="" disabled selected>vitamina</option>
            </select>
          </td>
          <td>
            <select name="medicamentoVia[]">
              <option value="" disabled selected>Selecione</option>
              <option value="Oral">Oral</option>
              <option value="Intravenosa">Intravenosa</option>
              <option value="Intramuscular">Intramuscular</option>
              <option value="Tópica">Tópica</option>
            </select>
          </td>
          <td>
            <input type="text" name="medicamentoPosologia[]" placeholder="Ex: 1 comprimido 3x/dia">
          </td>
          <td class="center">
            <a class="tooltip-container btn red white-text" onclick="removerLinha(this)">
              <i class="material-icons center">delete</i>
              <div class="custom-tooltip font-normal">Remover linha de medicamento</div>
            </a>
          </td>
        </tr>
      </tbody>
    </table>

    <div class="row center">
      <br>
      <a class="tooltip-container btn blue" onclick="adicionarLinhaMedicamento()">
        <i class="material-icons center">add</i>
        <div class="custom-tooltip font-normal">Adicionar linha de medicamento</div>
      </a>
    </div>
  </div>
</section>

<script src="">
   function adicionarLinha() {
    const tabela = document.getElementById('tabela-body');
    const linhaModelo = tabela.rows[0];
    const novaLinha = linhaModelo.cloneNode(true);

    // Substituir select-wrapper por selects novos
    const wrappersClonados = Array.from(novaLinha.querySelectorAll('.select-wrapper'));
    const selectsModelo = Array.from(linhaModelo.querySelectorAll('select'));

    wrappersClonados.forEach((wrapper, idx) => {
      const selectModelo = selectsModelo[idx];
      if (!selectModelo) {
        wrapper.remove();
        return;
      }

      const novoSelect = document.createElement('select');
      novoSelect.innerHTML = selectModelo.innerHTML;

      Array.from(selectModelo.attributes).forEach(attr => {
        if (attr.name.toLowerCase() !== 'id') {
          novoSelect.setAttribute(attr.name, attr.value);
        }
      });

      novoSelect.value = '';
      novoSelect.removeAttribute('id');

      wrapper.parentNode.replaceChild(novoSelect, wrapper);
    });

    // Limpar selects simples
    novaLinha.querySelectorAll('select').forEach(select => {
      select.value = '';
      select.classList.remove('initialized');
      select.removeAttribute('id');
    });

    // Limpar inputs e remover IDs
    novaLinha.querySelectorAll('input, textarea').forEach(el => {
      if (el.type === 'checkbox' || el.type === 'radio') {
        el.checked = false;
      } else {
        el.value = '';
      }
      el.removeAttribute('id');
    });

    tabela.appendChild(novaLinha);

    // Reinicializar Materialize
    setTimeout(() => {
      M.FormSelect.init(document.querySelectorAll('select'));
    }, 0);
  }

  function removerLinha(botao) {
    const linha = botao.closest('tr');
    const tabela = document.getElementById('tabela-body');
    if (tabela.rows.length > 1) {
      linha.remove();
    } else {
      M.toast({ html: 'A tabela deve conter pelo menos uma linha.', classes: 'red' });
    }
  }

</script>

</body>
</html>
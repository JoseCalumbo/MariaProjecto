<!-- Materialize CSS
<link href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css" rel="stylesheet">
<link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet" /> -->

<style>
  .nav {
    height: 46px;
    line-height: 46px;
  }

  body {
    background: #ccd0db;
  }

  /* SIDEBAR CHAT */
  .chat-sidebar {
    position: fixed;
    top: 45px;
    left: 0;
    width: 380px;
    height: calc(100vh - 45px);
    background: #fff;
    z-index: 999;
    transform: translateX(-100%);
    transition: transform .3s ease;
    display: flex;
    flex-direction: column;
    box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
  }

  .chat-sidebar.open {
    transform: translateX(0);
  }

  .chat-header {
    padding: 12px;
    background: #f5f5f5;
    border-bottom: 1px solid #ddd;
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  .chat-header h6 {
    margin: 0;
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .chat-messages {
    flex: 1;
    padding: 15px;
    background: #fafafa;
    overflow-y: auto;
  }

  .chat-input {
    padding: 12px;
    background: #fff;
    border-top: 1px solid #ddd;
    display: flex;
    gap: 8px;
  }

  .chat-input input {
    flex: 1;
    padding: 8px 12px;
    border: 1px solid #ddd;
    border-radius: 4px;
  }

  /* FLOAT BUTTON */
  .chat-fab {
    position: fixed;
    bottom: 20px;
    left: 20px;
    background: #1976d2;
    color: #fff;
    width: 56px;
    height: 56px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 4px 12px rgba(0, 0, 0, .3);
    cursor: pointer;
    z-index: 1001;
    transition: all .3s ease;
  }

  .chat-fab:hover {
    transform: scale(1.1);
    box-shadow: 0 6px 16px rgba(0, 0, 0, .4);
  }

  /* MAIN */
  main {
    padding: 5px 20px 20px;
    transition: margin-left .3s ease;
    max-width: 1400px;
    margin-left: auto;
    margin-right: auto;
  }

  .chat-sidebar.open~main {
    margin-left: calc(380px + (100vw - 1400px) / 2);
  }

  @media (max-width: 1400px) {
    .chat-sidebar.open~main {
      margin-left: 380px;
    }
  }

  /* T√çTULO DA P√ÅGINA - PRETO */
  .page-title {
    text-align: center;
    margin-bottom: 20px;
    color: #000000;
    font-weight: 500;
  }

  /* SUBT√çTULOS - PRETO */
  .box h6 {
    margin: 0 0 15px 0;
    font-weight: 500;
    color: #000000;
    display: flex;
    align-items: center;
    gap: 8px;
  }

  /* BOX */
  .box {
    background: #fff;
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(48, 47, 47, 0.08) !important;
    margin-bottom: 20px;
  }

  /* CHAT MESSAGE */
  .chat-message {
    margin-bottom: 12px;
    padding: 10px;
    border-radius: 8px;
    animation: slideIn 0.3s ease;
  }

  @keyframes slideIn {
    from {
      opacity: 0;
      transform: translateY(10px);
    }

    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .chat-message.user {
    background: #e3f2fd;
    text-align: right;
    margin-left: 40px;
  }

  .chat-message.system {
    background: #f5f5f5;
    margin-right: 40px;
  }

  /* CARD M√âDICO */
  .medico-card {
    border: 1px solid #e0e0e0;
    border-radius: 8px;
    padding: 15px;
    margin-bottom: 15px;
    transition: all 0.3s;
    cursor: pointer;
  }

  .medico-card:hover {
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    transform: translateY(-2px);
  }

  .medico-card.selected {
    border: 2px solid #1976d2;
    background: #e3f2fd;
  }

  .medico-info {
    display: flex;
    align-items: center;
    gap: 15px;
  }

  .medico-avatar {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    background: #1976d2;
    color: rgb(206, 11, 11);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 24px;
    font-weight: bold;
  }

  .medico-details h6 {
    margin: 0;
    color: #333;
    font-size: 16px;
  }

  .medico-details p {
    margin: 5px 0 0 0;
    color: #666;
    font-size: 14px;
  }

  .badge-disponivel {
    display: inline-block;
    padding: 4px 10px;
    border-radius: 12px;
    font-size: 11px;
    font-weight: 500;
    background: #d4edda;
    color: #155724;
    margin-top: 5px;
  }

  .badge-ocupado {
    display: inline-block;
    padding: 4px 10px;
    border-radius: 12px;
    font-size: 11px;
    font-weight: 500;
    background: #f8d7da;
    color: #721c24;
    margin-top: 5px;
  }

  /* ESTILOS PARA AS ABAS */
  .tabs {
    background-color: #9e9e9e;
    margin-bottom: 0;

  }

  .tabs .tab {
    margin-left: 0px 3px !important;
    border-left: 2px solid white !important;


  }

  .tabs .tab a {
    color: #1976d2;
    font-size: 13px;
    padding: 0 5px;
    text-align: center;

  }

  .tabs .tab a:hover {
    color: #0d47a1;
  }

  .tabs .tab a.active {
    color: #1976d2;
    font-weight: 500;
  }

  .tabs .indicator {
    background-color: #1976d2;
    height: 3px;
  }

  .tab-content {
    padding: 15px 0 !important;
    min-height: 300px;
  }

  /* HOR√ÅRIOS - NOVO ESTILO */
  .horarios-container {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
    gap: 10px;
    margin-top: 15px;
  }

  .horario-item {
    padding: 12px 8px;
    border: 2px solid #e0e0e0;
    border-radius: 6px;
    background: white;
    cursor: pointer;
    text-align: center;
    transition: all 0.3s;
    font-weight: 500;
  }

  .horario-item:hover {
    border-color: #1976d2;
    transform: translateY(-2px);
  }

  .horario-item.disponivel {
    border-color: #4caf50;
    color: #2e7d32;
    background: #e8f5e9;
  }

  .horario-item.disponivel:hover {
    border-color: #2e7d32;
    background: #c8e6c9;
  }

  .horario-item.selecionado {
    background: #009688 !important;
    color: white !important;
    border-color: #00796b !important;
  }

  .horario-item.ocupado {
    background: #ffebee !important;
    color: #c62828 !important;
    border-color: #ef9a9a !important;
    cursor: not-allowed;
    opacity: 0.7;
    text-decoration: line-through;
  }

  .horario-item.ocupado:hover {
    transform: none;
    border-color: #ef9a9a;
  }

  /* ALINHAMENTO DOS √çCONES */
  .btn i {
    vertical-align: middle;
    line-height: inherit;
    display: inline-flex;
    align-items: center;
  }

  /* VALIDA√á√ÉO */
  .input-field.error input,
  .input-field.error select {
    border-bottom: 1px solid #f44336 !important;
    box-shadow: 0 1px 0 0 #f44336 !important;
  }

  .error-message {
    color: #f44336;
    font-size: 12px;
    margin-top: 5px;
    display: none;
  }

  .error-message.show {
    display: block;
  }

  /* BOT√ÉO SELECIONAR M√âDICO */
  .btn-selecionar-medico {
    /* width: 100%; */
    margin-top: 15px;
    margin-bottom: 15px;
  }

  /* RESPONSIVO */
  @media (max-width: 992px) {
    .chat-sidebar {
      width: 100%;
    }

    .chat-sidebar.open~main {
      margin-left: 0;
    }
  }
</style>

<!-- CHAT BUTTON -->
<div class="chat-fab" id="btnOpenChat">
  <i class='bx bx-chat bx-sm'></i>
</div>

<!-- CHAT SIDEBAR -->
<div class="chat-sidebar" id="chatSidebar">
  <div class="chat-header">
    <h6><i class='bx bx-message-square-dots'></i> Assistente Virtual</h6>
    <a class="btn-flat" id="btnCloseChat"><i class='bx bx-x bx-sm'></i></a>
  </div>
  <div class="chat-messages" id="chatMessages">
    <div class="chat-message system">
      <strong>Assistente:</strong> Ol√°! Posso ajud√°-lo a agendar uma consulta. Qual especialidade voc√™ procura?
    </div>
  </div>
  <div class="chat-input">
    <input type="text" id="chatInput" placeholder="Digite sua mensagem...">
    <a class="btn blue" onclick="sendMsg()">
      <i class='bx bx-send'></i>
    </a>
  </div>
</div>

<!-- T√çTULO DA P√ÅGINA -->
<h5 class="page-title">Marcar Consulta</h5>
<hr>
<br>

<!-- MAIN CONTENT -->
<main id="mainContent">
  <!-- LAYOUT HORIZONTAL -->
  <div class="row">

    <!-- FORMUL√ÅRIO COM ABAS (DIREITA - 50%) -->
    <div class="col s12 l6">
      <div class="box" style="min-height: 650px;">
        <h6><i class='bx bx-calendar-plus'></i> Marcar Consulta</h6>

        <!-- Menu de Abas -->
        <div class="row">
          <div class="col s12">
            <ul class="tabs tabs-fixed-width" id="tabsContainer">
              <li class="tab col s6"><a class="active" href="#tabPaciente">
                  <i class='bx bx-user'></i> Dados do Paciente</a></li>
              <li class="tab col s6"><a href="#tabHorarios"><i class='bx bx-time'></i> Hor√°rios</a></li>
            </ul>
          </div>
        </div>

        <!-- Aba 1: Dados do Paciente -->
        <div id="tabPaciente" class="col s12 tab-content">
          <form id="formPaciente" style="margin-bottom: 0px !important; padding-bottom: 0px !important;">

            <div class="row" style="margin-bottom: 0px !important; padding-bottom: 0px !important;">
              <!-- <div class="input-field col s12">
                <select id="nomePaciente" required>
                  <option value="" disabled selected>Selecione o paciente</option>
                  <option value="Jo√£o Silva">Jo√£o Silva</option>
                  <option value="Maria Santos">Maria Santos</option>
                  <option value="Carlos Oliveira">Carlos Oliveira</option>
                  <option value="Ana Costa">Ana Costa</option>
                  <option value="Pedro Lima">Pedro Lima</option>
                  <option value="Juliana Pereira">Juliana Pereira</option>
                </select>
                <label>Nome do Paciente *</label>
                <span class="error-message" id="errorNome">Campo obrigat√≥rio</span>
              </div>-->

              <div class="input-field col s12 m8">
                <input type="text" id="nomePaciente" value="{{nome}}" disabled placeholder="">
                <label class="font-normal" for="medicoSelecionado" style="font-size: 18px !important;">Paciente:</label>
              </div>

              <div class="input-field col s12 m4">
                <input type="text" id="nomePaciente" value="{{id_paciente}}" disabled placeholder="">
                <label class="font-normal" for="medicoSelecionado" style="font-size: 18px !important;">C√≥digo:</label>
              </div>
            </div>

            <div class="row" style="margin-bottom: 0px !important; padding-bottom: 0px !important;">
              <div class="input-field col s6 m6">
                <input type="tel" id="telefone" value="{{telefone}}" required>
                <label class="font-normal" for="telefone" style="font-size: 18px !important;">Telefone *</label>
                <span class="error-message" id="errorTelefone">Campo obrigat√≥rio:</span>
              </div>

              <div class="input-field col s6 m6">
                <input type="email" id="email" value="{{email}}">
                <label class="font-normal" for="email" style="font-size: 18px !important;">E-mail:</label>
              </div>
            </div>

            <div class="row" style="margin-bottom: 0px !important; padding-bottom: 0px !important;">
              <div class="input-field col m12 s12">
                <select id="especialidade" required>
                  <option value="" disabled selected>Selecione a especialidade</option>
                  <option value="Cardiologia">Cardiologia</option>
                  <option value="Dermatologia">Dermatologia</option>
                  <option value="Ortopedia">Ortopedia</option>
                  <option value="Pediatria">Pediatria</option>
                  <option value="Ginecologia">Ginecologia</option>
                  <option value="Oftalmologia">Oftalmologia</option>
                  <option value="Psiquiatria">Psiquiatria</option>
                  <option value="Cl√≠nico Geral">Cl√≠nico Geral</option>
                </select>
                <label class="font-normal" style="font-size: 18px !important;">Especialidade: *</label>
                <span class="error-message" id="errorEspecialidade">Selecione uma especialidade</span>
              </div>
            </div>

            <div class="row" style="margin-bottom: 0px !important; padding-bottom: 0px !important;">
              <div class="input-field col m12 s12">
                <input type="date" id="dataConsulta" required>
                <label class="font-normal" style="font-size: 18px !important;" for="dataConsulta">Data da Consulta:
                  *</label>
                <span class="error-message" id="errorData">Campo obrigat√≥rio</span>
              </div>
            </div>

            <div class="row" style="margin-bottom: 0px !important; padding-bottom: 0px !important;">
              <div class="input-field col s12">
                <input type="text" id="medicoSelecionado" disabled placeholder="Nenhum m√©dico selecionado">
                <label class="font-normal" style="font-size: 18px !important;" for="medicoSelecionado">M√©dico</label>
              </div>
            </div>

            <div class="row" style="margin-bottom: 0px !important; padding-bottom: 0px !important;">
              <div class="col s12">
                <button id="horario" type="button"  class="btn teal btn-selecionar-medico font-normal" onclick="buscarMedicos() ">
              <i class="material-icons left icon-tight">Search</i> Buscar M√©dicos Dispon√≠veis
                </button>
              </div>
            </div>
            
          </form>
        </div>

        <!-- Aba 2: Hor√°rios -->
        <div id="tabHorarios" class="col s12 tab-content">
          <div class="row">
            <div class="col s12">
              <p class="grey-text">Selecione um hor√°rio dispon√≠vel</p>
              <div id="horariosDisponiveis" style="padding: 15px 0;">
                <p class="center-align" style="color: #999; padding: 40px;">
                  Selecione um m√©dico para ver os hor√°rios dispon√≠veis
                </p>
              </div>

              <div class="row" style="margin-top: 20px; display: none;" id="boxConfirmacao">
                <div class="col s12">
                  <button type="button" class="btn teal" onclick="salvarConsulta()">
                    <i class="material-icons left icon-tight">vaccines</i>Salvar Consulta
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- LISTA DE M√âDICOS (ESQUERDA - 50%) -->
    <div class="col s12 l6">
      <div class="box" style="min-height: 650px;">
        <h6><i class='bx bx-user-pin'></i> M√©dicos Dispon√≠veis</h6>

        <div id="listaMedicos" style="max-height: 700px; overflow-y: auto;">
          <p class="center-align" style="color: #999; padding: 40px;">
            Selecione uma especialidade e data para ver os m√©dicos dispon√≠veis
          </p>
        </div>
      </div>
    </div>

  </div>

</main>

<!-- Materialize JS -->
<script src="{{URL}}/Assets/js/materialize.min.js"></script>

<script>
  // Dados simulados
  const medicos = [
    {
      id: 1,
      nome: "Dr. Jo√£o Silva",
      especialidade: "Cardiologia",
      crm: "CRM 12345-SP",
      disponivel: true,
      horarios: ["08:00", "09:00", "10:00", "14:00", "15:00", "16:00"]
    },
    {
      id: 2,
      nome: "Dra. Maria Santos",
      especialidade: "Cardiologia",
      crm: "CRM 23456-SP",
      disponivel: true,
      horarios: ["09:00", "10:00", "11:00", "15:00", "16:00"]
    },
    {
      id: 3,
      nome: "Dr. Pedro Costa",
      especialidade: "Dermatologia",
      crm: "CRM 34567-SP",
      disponivel: true,
      horarios: ["08:00", "09:00", "13:00", "14:00", "15:00"]
    },
    {
      id: 4,
      nome: "Dra. Ana Oliveira",
      especialidade: "Dermatologia",
      crm: "CRM 45678-SP",
      disponivel: false,
      horarios: []
    },
    {
      id: 5,
      nome: "Dr. Carlos Mendes",
      especialidade: "Ortopedia",
      crm: "CRM 56789-SP",
      disponivel: true,
      horarios: ["08:00", "10:00", "14:00", "16:00"]
    },
    {
      id: 6,
      nome: "Dra. Beatriz Lima",
      especialidade: "Pediatria",
      crm: "CRM 67890-SP",
      disponivel: true,
      horarios: ["09:00", "10:00", "11:00", "14:00", "15:00", "16:00"]
    },
    {
      id: 7,
      nome: "Dra. Julia Ferreira",
      especialidade: "Ginecologia",
      crm: "CRM 78901-SP",
      disponivel: true,
      horarios: ["08:00", "09:00", "13:00", "14:00"]
    },
    {
      id: 8,
      nome: "Dr. Ricardo Alves",
      especialidade: "Oftalmologia",
      crm: "CRM 89012-SP",
      disponivel: true,
      horarios: ["10:00", "11:00", "14:00", "15:00", "16:00"]
    },
    {
      id: 9,
      nome: "Dra. Fernanda Rocha",
      especialidade: "Psiquiatria",
      crm: "CRM 90123-SP",
      disponivel: true,
      horarios: ["08:00", "09:00", "10:00", "13:00", "14:00"]
    },
    {
      id: 10,
      nome: "Dr. Lucas Martins",
      especialidade: "Cl√≠nico Geral",
      crm: "CRM 01234-SP",
      disponivel: true,
      horarios: ["08:00", "09:00", "10:00", "11:00", "14:00", "15:00", "16:00"]
    }
  ];

  let medicoSelecionado = null;
  let horarioSelecionado = null;

  // Inicializar Materialize
  document.addEventListener('DOMContentLoaded', function () {
    M.updateTextFields();
    M.FormSelect.init(document.querySelectorAll('select'));

    // Definir data m√≠nima como hoje
    const hoje = new Date().toISOString().split('T')[0];
    document.getElementById('dataConsulta').setAttribute('min', hoje);

    // Inicializar abas
    var tabs = document.querySelector('.tabs');
    if (tabs) {
      M.Tabs.init(tabs);
    }
  });

  // CHAT CONTROLS
  const chatSidebar = document.getElementById('chatSidebar');
  const btnOpen = document.getElementById('btnOpenChat');
  const btnClose = document.getElementById('btnCloseChat');

  btnOpen.onclick = () => {
    chatSidebar.classList.add('open');
    btnOpen.style.display = 'none';
  };

  btnClose.onclick = () => {
    chatSidebar.classList.remove('open');
    btnOpen.style.display = 'flex';
  };

  // CHAT
  function sendMsg() {
    const input = document.getElementById('chatInput');
    const mensagem = input.value.trim();

    if (!mensagem) {
      M.toast({ html: '‚ö†Ô∏è Digite uma mensagem', classes: 'orange' });
      return;
    }

    const chatMessages = document.getElementById('chatMessages');
    chatMessages.innerHTML += `
        <div class="chat-message user">
          <strong>Voc√™:</strong> ${mensagem}
        </div>
      `;

    input.value = '';
    chatMessages.scrollTop = chatMessages.scrollHeight;

    setTimeout(() => {
      chatMessages.innerHTML += `
          <div class="chat-message system">
            <strong>Assistente:</strong> Entendi. Estou aqui para ajudar com agendamento de consultas e informa√ß√µes sobre especialidades m√©dicas.
          </div>
        `;
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }, 1000);
  }

  document.getElementById('chatInput').addEventListener('keypress', function (e) {
    if (e.key === 'Enter') {
      sendMsg();
    }
  });

  // BUSCAR M√âDICOS
  function buscarMedicos() {
    const especialidade = document.getElementById('especialidade').value;
    const data = document.getElementById('dataConsulta').value;
    const nomePaciente = document.getElementById('nomePaciente').value;
    const telefone = document.getElementById('telefone').value.trim();

    // Valida√ß√£o b√°sica
    if (!nomePaciente) {
      M.toast({ html: '‚ö†Ô∏è Selecione um paciente', classes: 'orange' });
      return;
    }

    if (!telefone) {
      M.toast({ html: '‚ö†Ô∏è Informe o telefone', classes: 'orange' });
      return;
    }

    if (!especialidade || !data) {
      M.toast({ html: '‚ö†Ô∏è Selecione uma especialidade e data', classes: 'orange' });
      return;
    }

    const medicosDisponiveis = medicos.filter(m => m.especialidade === especialidade && m.disponivel);
    const listaMedicos = document.getElementById('listaMedicos');

    if (medicosDisponiveis.length === 0) {
      listaMedicos.innerHTML = `
          <p class="center-align" style="color: #999; padding: 40px;">
            Nenhum m√©dico dispon√≠vel para esta especialidade na data selecionada
          </p>
        `;

      medicoSelecionado = null;
      document.getElementById('medicoSelecionado').value = '';
      atualizarHorarios();
      document.getElementById('boxConfirmacao').style.display = 'none';
      return;
    }

    listaMedicos.innerHTML = '';
    medicosDisponiveis.forEach(medico => {
      const iniciais = medico.nome.split(' ').map(n => n[0]).join('').substring(0, 2);
      const badgeClass = 'badge-disponivel';
      const badgeText = '‚úì Dispon√≠vel';

      listaMedicos.innerHTML += `
          <div class="medico-card" 
               onclick="selecionarMedico(${medico.id})" 
               id="medico-${medico.id}">
            <div class="medico-info">
              <div class="medico-avatar">${iniciais}</div>
              <div class="medico-details">
                <h6>${medico.nome}</h6>
                <p>${medico.crm}</p>
                <span class="${badgeClass}">${badgeText}</span>
              </div>
            </div>
          </div>
        `;
    });

    M.toast({ html: `üìã ${medicosDisponiveis.length} m√©dico(s) encontrado(s)`, classes: 'blue' });
  }

  // SELECIONAR M√âDICO
  function selecionarMedico(id) {
    medicoSelecionado = medicos.find(m => m.id === id);

    // Remover sele√ß√£o anterior
    document.querySelectorAll('.medico-card').forEach(card => {
      card.classList.remove('selected');
    });

    // Adicionar sele√ß√£o
    document.getElementById(`medico-${id}`).classList.add('selected');

    // Atualizar campo m√©dico na aba 1
    document.getElementById('medicoSelecionado').value = medicoSelecionado.nome;
    M.updateTextFields();

    // Atualizar hor√°rios na aba 2
    atualizarHorarios();

    // Ativar aba de hor√°rios
    const instance = M.Tabs.getInstance(document.getElementById('tabsContainer'));
    instance.select('tabHorarios');

    M.toast({ html: `‚úÖ M√©dico selecionado: ${medicoSelecionado.nome}`, classes: 'green' });
  }

  // ATUALIZAR HOR√ÅRIOS
  function atualizarHorarios() {
    if (!medicoSelecionado) return;

    const container = document.getElementById('horariosDisponiveis');
    const boxConfirmacao = document.getElementById('boxConfirmacao');

    // Simula√ß√£o de hor√°rios j√° marcados (ocupados)
    // Vamos simular alguns hor√°rios ocupados aleatoriamente
    const horariosOcupados = [];
    const todosHorarios = medicoSelecionado.horarios;

    // Marcar 1-2 hor√°rios como ocupados aleatoriamente para demonstra√ß√£o
    if (todosHorarios.length > 0) {
      const randomIndex1 = Math.floor(Math.random() * todosHorarios.length);
      horariosOcupados.push(todosHorarios[randomIndex1]);

      if (todosHorarios.length > 2) {
        const randomIndex2 = Math.floor(Math.random() * todosHorarios.length);
        if (randomIndex2 !== randomIndex1) {
          horariosOcupados.push(todosHorarios[randomIndex2]);
        }
      }
    }

    container.innerHTML = `
        <p style="margin-bottom: 15px;"><strong>Hor√°rios dispon√≠veis para:</strong> ${medicoSelecionado.nome}</p>
        <div class="horarios-container"></div>
      `;

    const grid = container.querySelector('.horarios-container');

    if (todosHorarios.length === 0) {
      grid.innerHTML = `
          <p class="center-align" style="color: #999; padding: 20px; grid-column: 1 / -1;">
            Nenhum hor√°rio dispon√≠vel para este m√©dico
          </p>
        `;
      boxConfirmacao.style.display = 'none';
      return;
    }

    todosHorarios.forEach(horario => {
      const estaOcupado = horariosOcupados.includes(horario);
      const classe = estaOcupado ? 'ocupado' : 'disponivel';

      grid.innerHTML += `
          <div class="horario-item ${classe}" 
               onclick="${!estaOcupado ? `selecionarHorario('${horario}')` : ''}" 
               id="hora-${horario.replace(':', '')}">
            ${horario}
          </div>
        `;
    });

    boxConfirmacao.style.display = 'none';
    horarioSelecionado = null;
  }

  // SELECIONAR HOR√ÅRIO
  function selecionarHorario(horario) {
    horarioSelecionado = horario;

    // Remover sele√ß√£o anterior
    document.querySelectorAll('.horario-item').forEach(item => {
      item.classList.remove('selecionado');
    });

    // Adicionar sele√ß√£o
    const elemento = document.getElementById(`hora-${horario.replace(':', '')}`);
    if (elemento) {
      elemento.classList.add('selecionado');
    }

    // Mostrar bot√£o de confirma√ß√£o
    document.getElementById('boxConfirmacao').style.display = 'block';

    M.toast({ html: `üïê Hor√°rio selecionado: ${horario}`, classes: 'teal' });
  }

  // SALVAR CONSULTA
  function salvarConsulta() {
    const nomePaciente = document.getElementById('nomePaciente').value;
    const telefone = document.getElementById('telefone').value.trim();
    const data = document.getElementById('dataConsulta').value;

    if (!nomePaciente || !telefone || !medicoSelecionado || !horarioSelecionado) {
      M.toast({ html: '‚ö†Ô∏è Preencha todos os campos e selecione m√©dico e hor√°rio', classes: 'orange' });
      return;
    }

    const dataFormatada = new Date(data + 'T00:00:00').toLocaleDateString('pt-BR');

    M.toast({
      html: `‚úÖ Consulta agendada com sucesso!<br>
               <strong>Paciente:</strong> ${nomePaciente}<br>
               <strong>M√©dico:</strong> ${medicoSelecionado.nome}<br>
               <strong>Data:</strong> ${dataFormatada} √†s ${horarioSelecionado}`,
      classes: 'green',
      displayLength: 8000
    });

    // Limpar formul√°rio ap√≥s 2 segundos
    setTimeout(() => {
      document.getElementById('formPaciente').reset();
      document.getElementById('listaMedicos').innerHTML = `
          <p class="center-align" style="color: #999; padding: 40px;">
            Selecione uma especialidade e data para ver os m√©dicos dispon√≠veis
          </p>
        `;

      // Limpar sele√ß√µes
      medicoSelecionado = null;
      horarioSelecionado = null;
      document.getElementById('medicoSelecionado').value = '';
      document.getElementById('horariosDisponiveis').innerHTML = `
          <p class="center-align" style="color: #999; padding: 40px;">
            Selecione um m√©dico para ver os hor√°rios dispon√≠veis
          </p>
        `;
      document.getElementById('boxConfirmacao').style.display = 'none';

      // Voltar para a primeira aba
      const instance = M.Tabs.getInstance(document.getElementById('tabsContainer'));
      instance.select('tabPaciente');

      M.updateTextFields();
      M.FormSelect.init(document.querySelectorAll('select'));
    }, 2000);
  }

  // Atualizar campo m√©dico quando selecionar especialidade
  document.getElementById('especialidade').addEventListener('change', function () {
    medicoSelecionado = null;
    document.getElementById('medicoSelecionado').value = '';
    M.updateTextFields();
  });

  // Atualizar campo m√©dico quando mudar data
  document.getElementById('dataConsulta').addEventListener('change', function () {
    medicoSelecionado = null;
    document.getElementById('medicoSelecionado').value = '';
    M.updateTextFields();
  });
</script>

<!-- Arquivo AJAX -->
<script src="{{URL}}/Assets/js/ajax/Xhttp.js"></script>
<script src="{{URL}}/Assets/js/ajax/marcarConsulta.js"></script>

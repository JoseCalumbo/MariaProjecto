<section class="row section-field">

  <div class="row col m4 ">
    <h5 class="center" style="text-transform: capitalize;"> Dados do paciente</h5>

    <section>
      <nav style="height: 35px; display: flex; align-items: center;
       background-color: #f5f5f5; box-shadow: none; justify-content: space-between;">
        <ul>
          <li style="margin-left: 15px; text-transform: lowercase;">Dados pessoal</li>
        </ul>
        <a class="btn grey font-normal center" href="{{URL}}/paciente/editar/{{id_paciente}}" target="_blank">
          Editar dados
        </a>
      </nav>

      <div class="white row">
        <img src="{{URL}}/Files/Imagem/paciente/{{imagem}}" style="margin-left: 5px;" class="materialboxed col m2 "
          width="50" height="90">
        <span class="col m9"><strong>Nome:</strong> {{nome}}</span>
        <span class="col m3"><strong>Idade:</strong> {{data}} anos</span>
        <span class="col m5"><strong>Genero:</strong> {{genero}}</span>
        <span class="col m5"><strong>Telefone:</strong> {{telefone1}}</span>
        <span class="col m9 font-normal"><strong>E-mail:</strong> {{email}}</span>
        <span class="col m9" style="margin-left: 20px;"><strong>Morada:</strong> {{morada}}</span>
      </div>
    </section>

    <section>
      <nav style="height: 35px; display: flex; align-items: center; background-color: #f5f5f5; box-shadow: none;">
        <ul>
          <li style="margin-left: 15px; text-transform: lowercase;">Dados da triagem</li>
        </ul>
      </nav>
      <div class="white row">
        <span class="col m9" style="margin-left: 20px;"><strong>Peso:</strong> {{peso}}</span>
        <span class="col m9" style="margin-left: 20px;"><strong>Temperatura Corporal:</strong> {{temperatura}}</span>
        <span class="col m9" style="margin-left: 20px;"><strong>Saturação de Oxigênio:</strong> {{saturacao}}</span>
        <span class="col m9" style="margin-left: 20px;"><strong>Pressão Arterial:</strong> {{pressao}}</span>
        <span class="col m9" style="margin-left: 20px;"><strong>Frequência Respiratória:</strong> {{frequencia}}</span>
        <span class="col m9" style="margin-left: 20px;"><strong><br></span>
        <span class="col m9" style="margin-left: 20px;"><strong>Observação:</strong> {{observacao}}</span>

      </div>
    </section>
  </div>

  <div class=" row offset-m1 col m7 s12">
    <h5 class="center" style="text-transform: capitalize;"> {{titulo}} </h5>

    <div class="col s12 blue-grey darken-1 row">
      <!--header das abas-->
      <ul class="tabs tabsvendedor blue-grey darken-1 "
        style="height: 35px; display: flex; align-items: center; justify-self: start; background-color: #f5f5f5; box-shadow: none;">
        <li class="tab"><a class="active font-normal" href="#consultaDados">Consulta</a></li>
        <li class="tab"><a class="font-normal" href="#exameDados">Exames</a></li>
      </ul>
    </div>

    <!-- formulario para resgistar consulta -->
    <form class="" method="post" enctype="multipart/form-data">

      <!--aba consulta-->
      <section id="consultaDados" class="col m12 s12">
        <div class="row col m12">
          <br>
          <div class="input-field col s12 m6">
            <input id="motivo" type="text" name="motivo" value="{{motivo}}" class="validate">
            <label for="motivo" style="text-transform: capitalize;">Motivo da consulta:</label>
          </div>

          <div class="input-field col s12 m6">
            <input id="Observação" type="text" name="obs" value="{{obs}}" class="validate">
            <label for="Observação" style="text-transform: capitalize;">Observação:</label>
          </div>

          <div class="input-field col s12 m12">
            <input id="Diagnóstico" type="text" name="diagnostico" value="{{diagnostico}}" class="validate">
            <label for="Diagnóstico" style="text-transform: capitalize;">Diagnóstico:</label>
          </div>

          <div class="input-field col m12 s12">
            <textarea id="textarea1" class="materialize-textarea" name="conduta"> {{conduta}}</textarea>
            <label for="textarea1" style="text-transform: capitalize;">Conduta</label>
          </div>

        </div>

      </section>

      <!--Aba exame-->
      <section id="exameDados" class="col m12 s12">
        <div class="col m12">
          <br>
          <table class="responsive-table">
            <thead>
              <tr class="rows">
                <th class="grey lighten-1 font-normal" style="border-right: 2px solid #fcfcfc; width: 20%;">Tipo</th>
                <th class="grey lighten-1 font-normal" style="border-right: 2px solid #fcfcfc; width: 50%;">Nome</th>
                <th class="grey lighten-1 font-normal" style="border-right: 2px solid #fcfcfc; width: 20%;">Nivel de
                  Urgencia</th>
                <th class=" grey lighten-1 font-normal" style="border-right: 2px solid #fcfcfc; width: 10%;">Ação</th>
              </tr>
            </thead>
            <tbody id="tabela-body">
              <tr class="row">
                <td>
                  <select name="examesTipo[]" id="">
                    <option value="" disabled selected>seleciona</option>
                    <option value="Imagem">Imagem</option>
                    <option value="Imagem">Hematologia</option>
                    <option value="Imunologia">Imunologia</option>
                    <option value="Bioquímica">Bioquímica</option>
                  </select>
                </td>
                <td>
                  <select name="examesNome[]">
                    <option value="" disabled selected>seleciona</option>
                    {{exames}}
                  </select>
                </td>
                <td>
                  <select name="examesEmergrncia[]" id="">
                    <option value="" disabled selected>seleciona</option>
                    <option value="Não-Urgente">Não Urgente</option>
                    <option value="Pouco-Urgente">Pouco Urgente</option>
                    <option value="Urgente">Urgente</option>
                    <option value="Muito Urgente">Muito Urgente</option>
                    <option value="Emergente">Emergente</option>
                  </select>
                </td>
                <td class="center">
                  <a class="tooltip-container btn red white-text" onclick="removerLinha(this)">
                    <i class="material-icons center">delete</i>
                    <div class="custom-tooltip font-normal ">Remover linha de exame</div>
                  </a>
                </td>
              </tr>
            </tbody>
          </table>

          <div class="row center ">
            <br>
            <a class="tooltip-container btn teal" onclick="adicionarLinha()">
              <i class="material-icons center">add</i>
              <div class="custom-tooltip font-normal ">Adicionar linha</div>
            </a>
          </div>
        </div>

      </section>

      <div class="div-input push-m9 col s12 m2 row ">
        <button class=" col m12 btn white-text font-normal" name="salvar" type="submit">{{button}}</button>
      </div>

    </form>

  </div>
</section>


<script src="{{URL}}/Assets/js/main.js"></script>

<script>

  function adicionarLinha() {
    const tabela = document.getElementById('tabela-body');
    const linhaModelo = tabela.rows[0];
    const novaLinha = linhaModelo.cloneNode(true);

    // Substituir select-wrapper por selects novos
    const wrappersClonados = Array.from(novaLinha.querySelectorAll('.select-wrapper'));
    const selectsModelo = Array.from(linhaModelo.querySelectorAll('select'));

    wrappersClonados.forEach((wrapper, idx) => {
      const selectModelo = selectsModelo[idx];
      if (!selectModelo) {
        wrapper.remove();
        return;
      }

      const novoSelect = document.createElement('select');
      novoSelect.innerHTML = selectModelo.innerHTML;

      Array.from(selectModelo.attributes).forEach(attr => {
        if (attr.name.toLowerCase() !== 'id') {
          novoSelect.setAttribute(attr.name, attr.value);
        }
      });

      novoSelect.value = '';
      novoSelect.removeAttribute('id');

      wrapper.parentNode.replaceChild(novoSelect, wrapper);
    });

    // Limpar selects simples
    novaLinha.querySelectorAll('select').forEach(select => {
      select.value = '';
      select.classList.remove('initialized');
      select.removeAttribute('id');
    });

    // Limpar inputs e remover IDs
    novaLinha.querySelectorAll('input, textarea').forEach(el => {
      if (el.type === 'checkbox' || el.type === 'radio') {
        el.checked = false;
      } else {
        el.value = '';
      }
      el.removeAttribute('id');
    });

    tabela.appendChild(novaLinha);

    // Reinicializar Materialize
    setTimeout(() => {
      M.FormSelect.init(document.querySelectorAll('select'));
    }, 0);
  }


  function removerLinha(botao) {
    const linha = botao.closest('tr');
    const tabela = document.getElementById('tabela-body');
    if (tabela.rows.length > 1) {
      linha.remove();
    } else {
      M.toast({ html: 'A tabela deve conter pelo menos uma linha.', classes: 'red' });
    }
  }


</script>